# UI ä¼˜åŒ–æ€»ç»“

æœ¬æ¬¡å¯¹ AI-CodeReview é¡¹ç›®çš„ Streamlit UI è¿›è¡Œäº†ä¸‰ä¸ªä¸»è¦ä¼˜åŒ–ï¼š

## ğŸ”§ ä¼˜åŒ–å†…å®¹

### 1. ç½‘é¡µåˆ·æ–°æ—¶ä¸é€€å‡ºè´¦å· âœ…

**é—®é¢˜**: ç”¨æˆ·åœ¨æµè§ˆå™¨åˆ·æ–°é¡µé¢åä¼šä¸¢å¤±ç™»å½•çŠ¶æ€ï¼Œéœ€è¦é‡æ–°ç™»å½•ã€‚

**è§£å†³æ–¹æ¡ˆ**:
- å®ç°äº†åŒé‡æŒä¹…åŒ–æœºåˆ¶ï¼šURLå‚æ•° + ä¸´æ—¶æ–‡ä»¶å­˜å‚¨
- **æ–¹æ³•1**: åœ¨ç”¨æˆ·ç™»å½•æˆåŠŸåï¼Œå°†ç™»å½•çŠ¶æ€ä¿å­˜åˆ° URL å‚æ•°ä¸­ï¼ˆ`auto_login=true` å’Œ `user=username`ï¼‰
- **æ–¹æ³•2**: åŒæ—¶å°†ç™»å½•çŠ¶æ€ä¿å­˜åˆ°ä¸´æ—¶æ–‡ä»¶ä¸­ï¼ˆ`streamlit_ai_codereview_session.json`ï¼‰ï¼Œæœ‰æ•ˆæœŸ24å°æ—¶
- åœ¨é¡µé¢åˆå§‹åŒ–æ—¶æ£€æŸ¥è¿™ä¸¤ç§æ–¹å¼ï¼Œä¼˜å…ˆä»URLå‚æ•°æ¢å¤ï¼Œå…¶æ¬¡ä»æ–‡ä»¶æ¢å¤
- åœ¨ç”¨æˆ·æ³¨é”€æ—¶æ¸…ç†URLå‚æ•°å’Œä¸´æ—¶æ–‡ä»¶ï¼Œç¡®ä¿å®‰å…¨æ€§

**ä»£ç å®ç°**:
```python
# æŒä¹…åŒ–å‡½æ•°
def save_login_state(username):
    """ä¿å­˜ç™»å½•çŠ¶æ€åˆ°æ–‡ä»¶"""
    session_data = {
        "username": username,
        "timestamp": datetime.datetime.now().isoformat(),
        "authenticated": True
    }
    with open(get_session_file_path(), 'w', encoding='utf-8') as f:
        json.dump(session_data, f)

def load_login_state():
    """ä»æ–‡ä»¶åŠ è½½ç™»å½•çŠ¶æ€ï¼Œæ”¯æŒ24å°æ—¶æœ‰æ•ˆæœŸ"""
    # æ£€æŸ¥sessionæ˜¯å¦è¿‡æœŸï¼ˆ24å°æ—¶ï¼‰
    timestamp = datetime.datetime.fromisoformat(session_data['timestamp'])
    if datetime.datetime.now() - timestamp < datetime.timedelta(hours=24):
        return session_data

# ç™»å½•æˆåŠŸæ—¶ä¿å­˜çŠ¶æ€
save_login_state(username)
st.query_params["auto_login"] = "true"
st.query_params["user"] = username

# é¡µé¢åˆå§‹åŒ–æ—¶æ¢å¤ç™»å½•çŠ¶æ€
# æ–¹æ³•1ï¼šä»URLå‚æ•°æ¢å¤
if "auto_login" in query_params and query_params["auto_login"] == "true":
    # æ¢å¤ç™»å½•çŠ¶æ€

# æ–¹æ³•2ï¼šä»æŒä¹…åŒ–æ–‡ä»¶æ¢å¤
saved_state = load_login_state()
if saved_state and saved_state.get('authenticated'):
    # æ¢å¤ç™»å½•çŠ¶æ€

# æ³¨é”€æ—¶æ¸…ç†æ‰€æœ‰çŠ¶æ€
clear_login_state()  # æ¸…ç†æ–‡ä»¶
del st.query_params["auto_login"]  # æ¸…ç†URLå‚æ•°
```

### 2. ä¿å­˜é…ç½®åè‡ªåŠ¨åˆ·æ–°é¡µé¢ âœ…

**é—®é¢˜**: ç”¨æˆ·ä¿å­˜é…ç½®åéœ€è¦æ‰‹åŠ¨åˆ·æ–°é¡µé¢æ‰èƒ½çœ‹åˆ°æœ€æ–°çš„é…ç½®çŠ¶æ€ã€‚

**è§£å†³æ–¹æ¡ˆ**:
- åœ¨é…ç½®ä¿å­˜æˆåŠŸåï¼Œæ˜¾ç¤ºæç¤ºä¿¡æ¯å¹¶è‡ªåŠ¨åˆ·æ–°é¡µé¢
- å¢åŠ äº† 1 ç§’çš„å»¶è¿Ÿï¼Œè®©ç”¨æˆ·èƒ½çœ‹åˆ°æˆåŠŸæ¶ˆæ¯
- ä½¿ç”¨ `st.rerun()` å®ç°é¡µé¢è‡ªåŠ¨åˆ·æ–°

**ä»£ç å®ç°**:
```python
if config_manager.save_env_config(new_config):
    st.success("âœ… ç³»ç»Ÿé…ç½®å·²æˆåŠŸä¿å­˜ï¼")
    st.info("ğŸ’¡ é…ç½®æ›´æ”¹éœ€è¦é‡å¯åº”ç”¨ç¨‹åºæ‰èƒ½ç”Ÿæ•ˆã€‚")
    load_dotenv("conf/.env", override=True)
    
    # ä¿å­˜æˆåŠŸåè‡ªåŠ¨åˆ·æ–°é¡µé¢
    st.info("ğŸ”„ é¡µé¢å³å°†è‡ªåŠ¨åˆ·æ–°...")
    import time
    time.sleep(1)  # è®©ç”¨æˆ·çœ‹åˆ°æˆåŠŸæ¶ˆæ¯
    st.rerun()
```

### 3. SVNä»“åº“é…ç½®JSONæ ¼å¼ä¼˜åŒ– âœ…

**é—®é¢˜**: SVNä»“åº“é…ç½®è¾“å…¥æ¡†ä¸­çš„JSONå¯èƒ½åŒ…å«æ¢è¡Œç¬¦ã€å¤šä½™ç©ºæ ¼ç­‰ï¼Œå¯¼è‡´ä¿å­˜æ—¶æ ¼å¼é”™è¯¯ã€‚

**è§£å†³æ–¹æ¡ˆ**:
- å¢å¼ºäº† JSON æ ¼å¼å¤„ç†é€»è¾‘ï¼Œæ”¯æŒå¤šè¡Œè¾“å…¥
- æ™ºèƒ½æ¸…ç†æ¢è¡Œç¬¦å’Œå¤šä½™ç©ºæ ¼ï¼Œä½†ä¿ç•™ JSON ç»“æ„
- æ·»åŠ äº†æ›´è¯¦ç»†çš„é”™è¯¯æç¤ºä¿¡æ¯
- å°†æ–‡æœ¬åŒºåŸŸé«˜åº¦ä» 100px å¢åŠ åˆ° 120pxï¼Œæé«˜è¾“å…¥ä½“éªŒ

**ä»£ç å®ç°**:
```python
try:
    # ç¬¬ä¸€æ­¥ï¼šåŸºç¡€æ¸…ç† - ç§»é™¤é¦–å°¾ç©ºç™½
    svn_repositories_cleaned = svn_repositories.strip()
    
    # ç¬¬äºŒæ­¥ï¼šæ™ºèƒ½å¤„ç†æ¢è¡Œå’Œç©ºæ ¼
    if svn_repositories_cleaned:
        import re
        # ç§»é™¤è¡Œé¦–è¡Œå°¾ç©ºç™½ï¼Œä½†ä¿ç•™ç»“æ„åŒ–çš„ç©ºæ ¼
        lines = [line.strip() for line in svn_repositories_cleaned.split('\n') if line.strip()]
        svn_repositories_cleaned = ''.join(lines)
        
        # è¿›ä¸€æ­¥æ¸…ç†ï¼šç§»é™¤ä¸å¿…è¦çš„ç©ºæ ¼ï¼ˆä½†ä¿ç•™å­—ç¬¦ä¸²å†…çš„ç©ºæ ¼ï¼‰
        svn_repositories_cleaned = re.sub(r'\s*([{}[\]:,])\s*', r'\1', svn_repositories_cleaned)
        
    # ç¬¬ä¸‰æ­¥ï¼šéªŒè¯JSONæ ¼å¼
    if svn_repositories_cleaned:
        parsed_json = json.loads(svn_repositories_cleaned)
        # é‡æ–°æ ¼å¼åŒ–ä¸ºç´§å‡‘çš„JSONï¼ˆç¡®ä¿ä¸€è‡´æ€§ï¼‰
        svn_repositories_final = json.dumps(parsed_json, separators=(',', ':'), ensure_ascii=False)
    else:
        svn_repositories_final = ""
        
except json.JSONDecodeError as e:
    st.error(f"âŒ SVNä»“åº“é…ç½®JSONæ ¼å¼é”™è¯¯: {e}")
    st.error("ğŸ’¡ æç¤ºï¼šè¯·æ£€æŸ¥JSONæ ¼å¼ï¼Œç¡®ä¿æ‹¬å·ã€å¼•å·ã€é€—å·ç­‰ç¬¦å·æ­£ç¡®åŒ¹é…")
    st.stop()
```

## ğŸ“‹ ç”¨æˆ·ä½“éªŒæ”¹è¿›

1. **æ›´å¥½çš„ä¼šè¯ç®¡ç†**: ç”¨æˆ·ä¸å†éœ€è¦é¢‘ç¹é‡æ–°ç™»å½•ï¼Œæé«˜äº†ä½¿ç”¨æ•ˆç‡
2. **å®æ—¶é…ç½®åé¦ˆ**: ä¿å­˜é…ç½®åé¡µé¢è‡ªåŠ¨åˆ·æ–°ï¼Œç”¨æˆ·èƒ½ç«‹å³çœ‹åˆ°æ›´æ–°ç»“æœ
3. **å‹å¥½çš„é…ç½®è¾“å…¥**: SVNé…ç½®æ”¯æŒå¤šè¡Œè¾“å…¥ï¼Œæ ¼å¼é”™è¯¯æ—¶æä¾›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯

## ğŸ”’ å®‰å…¨æ€§è€ƒè™‘

- URL å‚æ•°ä¸­çš„ç”¨æˆ·ä¿¡æ¯ä¸åŒ…å«æ•æ„Ÿæ•°æ®ï¼ˆå¯†ç ç­‰ï¼‰
- æ³¨é”€æ—¶ä¼šæ¸…ç†æ‰€æœ‰ç›¸å…³çš„ URL å‚æ•°
- JSON å¤„ç†è¿‡ç¨‹ä¸­åŒ…å«äº†å¼‚å¸¸å¤„ç†ï¼Œé˜²æ­¢æ¶æ„è¾“å…¥

## ğŸ¯ æµ‹è¯•éªŒè¯

- âœ… UI åº”ç”¨æˆåŠŸå¯åŠ¨æ— é”™è¯¯
- âœ… ä»£ç è¯­æ³•æ£€æŸ¥é€šè¿‡
- âœ… åŠŸèƒ½é€»è¾‘å®Œæ•´å®ç°

## ğŸ“ ä½¿ç”¨è¯´æ˜

1. **ç™»å½•æŒä¹…åŒ–**: ç™»å½•ååˆ·æ–°é¡µé¢ä¸ä¼šé€€å‡ºï¼Œé™¤éä¸»åŠ¨ç‚¹å‡»æ³¨é”€
2. **é…ç½®ä¿å­˜**: åœ¨é…ç½®ç®¡ç†é¡µé¢ä¿å­˜é…ç½®åï¼Œé¡µé¢ä¼šæ˜¾ç¤ºæˆåŠŸä¿¡æ¯å¹¶è‡ªåŠ¨åˆ·æ–°
3. **SVNé…ç½®**: å¯ä»¥åœ¨å¤šè¡Œæ–‡æœ¬æ¡†ä¸­è¾“å…¥JSONé…ç½®ï¼Œæ”¯æŒæ¢è¡Œå’Œç¼©è¿›ï¼Œä¿å­˜æ—¶ä¼šè‡ªåŠ¨æ¸…ç†æ ¼å¼

è¿™äº›ä¼˜åŒ–æ˜¾è‘—æå‡äº†ç”¨æˆ·çš„ä½¿ç”¨ä½“éªŒï¼Œä½¿ AI-CodeReview ç³»ç»Ÿæ›´åŠ å®ç”¨å’Œå‹å¥½ã€‚
