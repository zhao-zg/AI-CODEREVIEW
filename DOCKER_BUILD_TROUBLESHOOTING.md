# Docker æ„å»ºæ•…éšœæ’é™¤æŒ‡å—

## é—®é¢˜ï¼šERROR: failed to solve: target stage "app" could not be found

### ğŸ” é—®é¢˜åˆ†æ

è¿™ä¸ªé”™è¯¯é€šå¸¸å‘ç”Ÿåœ¨ä»¥ä¸‹æƒ…å†µï¼š

1. **ä½¿ç”¨äº†é”™è¯¯çš„æ„å»ºå‘½ä»¤**ï¼šå°è¯•ä½¿ç”¨å¤šé˜¶æ®µæ„å»ºçš„ `--target` å‚æ•°
2. **Docker ç¼“å­˜é—®é¢˜**ï¼šç¼“å­˜äº†ä¹‹å‰çš„å¤šé˜¶æ®µæ„å»ºä¿¡æ¯
3. **ä½¿ç”¨äº†è¿‡æ—¶çš„æ–‡æ¡£æˆ–è„šæœ¬**

### âœ… è§£å†³æ–¹æ¡ˆ

#### 1. ä½¿ç”¨æ­£ç¡®çš„æ„å»ºå‘½ä»¤

**æ­£ç¡®çš„å•æœåŠ¡æ„å»ºå‘½ä»¤ï¼š**
```bash
# åŸºæœ¬æ„å»º
docker build -t ai-codereview .

# æ¸…é™¤ç¼“å­˜é‡æ–°æ„å»º
docker build --no-cache -t ai-codereview .

# ä½¿ç”¨ docker-compose æ„å»º
docker-compose build

# å¼ºåˆ¶é‡æ–°æ„å»º
docker-compose build --no-cache
```

**âŒ é”™è¯¯çš„å‘½ä»¤ï¼ˆä¸è¦ä½¿ç”¨ï¼‰ï¼š**
```bash
# è¿™äº›å‘½ä»¤ä¼šå¯¼è‡´é”™è¯¯ï¼Œå› ä¸ºå½“å‰æ˜¯å•é˜¶æ®µæ„å»º
docker build --target app -t ai-codereview .
docker build --target worker -t ai-codereview .
```

#### 2. æ¸…ç† Docker ç¼“å­˜

```bash
# æ¸…ç†æ„å»ºç¼“å­˜
docker builder prune

# æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨çš„é•œåƒ
docker image prune -a

# å®Œå…¨æ¸…ç†ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰
docker system prune -a
```

#### 3. éªŒè¯ Dockerfile

å½“å‰çš„ Dockerfile æ˜¯å•é˜¶æ®µæ„å»ºï¼Œæ­£ç¡®çš„ç»“æ„ï¼š

```dockerfile
# å•é˜¶æ®µæ„å»º - æ‰€æœ‰åŠŸèƒ½åœ¨ä¸€ä¸ªé˜¶æ®µå®Œæˆ
FROM python:3.12-slim
WORKDIR /app
# ... å®‰è£…å’Œé…ç½® ...
CMD ["/app/start.sh"]
```

### ğŸš€ æ¨èçš„æ„å»ºæµç¨‹

#### æœ¬åœ°å¼€å‘
```bash
# 1. æ„å»ºé•œåƒ
docker build -t ai-codereview .

# 2. è¿è¡Œå®¹å™¨
docker-compose up -d

# 3. æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f
```

#### ç”Ÿäº§éƒ¨ç½²
```bash
# 1. æ‹‰å–æœ€æ–°ä»£ç 
git pull

# 2. æ„å»ºå¹¶å¯åŠ¨
docker-compose up -d --build

# 3. éªŒè¯æœåŠ¡
curl http://localhost:5001
curl http://localhost:5002
```

### ğŸ”§ æ¶æ„è¯´æ˜

**å½“å‰æ¶æ„ï¼ˆå•æœåŠ¡ï¼‰ï¼š**
- âœ… ä¸€ä¸ªå®¹å™¨åŒ…å«æ‰€æœ‰åŠŸèƒ½
- âœ… API + UI + Worker åœ¨åŒä¸€è¿›ç¨‹ä¸­
- âœ… ä½¿ç”¨å†…å­˜é˜Ÿåˆ—ï¼Œæ— éœ€ Redis
- âœ… ç®€åŒ–éƒ¨ç½²å’Œè¿ç»´

**ä¹‹å‰æ¶æ„ï¼ˆå¤šå®¹å™¨ï¼‰ï¼š**
- âŒ éœ€è¦å¤šä¸ªå®¹å™¨åè°ƒ
- âŒ éœ€è¦ Redis ç­‰å¤–éƒ¨ä¾èµ–
- âŒ éƒ¨ç½²å¤æ‚ï¼Œè¿ç»´å›°éš¾

### ğŸ“ å¸¸è§é—®é¢˜

1. **ç½‘ç»œè¿æ¥é—®é¢˜**
   ```bash
   # å¦‚æœæ— æ³•ä¸‹è½½åŸºç¡€é•œåƒï¼Œæ£€æŸ¥ç½‘ç»œè¿æ¥
   docker pull python:3.12-slim
   ```

2. **æƒé™é—®é¢˜**
   ```bash
   # ç¡®ä¿ Docker æœåŠ¡æ­£åœ¨è¿è¡Œ
   docker version
   ```

3. **ç«¯å£å†²çª**
   ```bash
   # æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨
   netstat -tlnp | grep 5001
   netstat -tlnp | grep 5002
   ```

### ğŸ¯ æˆåŠŸæ„å»ºéªŒè¯

æ„å»ºæˆåŠŸåï¼Œæ‚¨åº”è¯¥çœ‹åˆ°ï¼š
```bash
# æ£€æŸ¥é•œåƒ
docker images | grep ai-codereview

# æ£€æŸ¥è¿è¡ŒçŠ¶æ€
docker-compose ps

# æµ‹è¯•æœåŠ¡
curl http://localhost:5001/health
```

---
âœ… **æ€»ç»“**ï¼šä½¿ç”¨å•é˜¶æ®µæ„å»ºå‘½ä»¤ï¼Œæ¸…ç†ç¼“å­˜ï¼Œé¿å…ä½¿ç”¨ `--target` å‚æ•°ã€‚
